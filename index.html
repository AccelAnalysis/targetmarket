<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Target Market Discovery | Accel Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        
        /* Custom scrollbar for sidebar */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }

        .transition-width {
            transition: width 0.5s ease-in-out;
        }

        /* Custom Radio/Checkbox Styles */
        .custom-radio:checked + div {
            border-color: #2563EB; /* Blue-600 */
            background-color: #EFF6FF; /* Blue-50 */
            color: #1E3A8A;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 h-16 flex items-center justify-between px-6 shadow-sm z-20 relative">
        <div class="flex items-center gap-3">
            <img src="https://img1.wsimg.com/isteam/ip/0815fdc9-aafc-4fe1-99f8-dedc9ba0e23b/blob-f3ca1db.png/:/rs=w:166,h:200,cg:true,m/cr=w:166,h:200/qt=q:95" alt="Accel Analysis Logo" class="h-10 w-auto">
            <span class="font-bold text-xl tracking-tight text-slate-800 hidden md:block">Accel Analysis</span>
        </div>
        <div class="text-sm font-medium text-slate-500">Target Market Discovery</div>
    </header>

    <!-- Main Layout -->
    <div class="flex flex-1 overflow-hidden relative">
        
        <!-- Sidebar Navigation (Desktop) -->
        <aside class="w-64 bg-slate-900 text-slate-300 flex-col hidden md:flex overflow-y-auto z-10">
            <div class="p-6">
                <h3 class="text-xs uppercase tracking-wider font-semibold text-slate-500 mb-4">Sections</h3>
                <nav class="space-y-1" id="desktop-nav">
                    <!-- Nav items generated by JS -->
                </nav>
            </div>
            
            <div class="mt-auto p-6 border-t border-slate-800">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold text-xs">
                        <i class="fas fa-user"></i>
                    </div>
                    <div>
                        <p class="text-xs font-medium text-white">Client Mode</p>
                        <p class="text-[10px] text-slate-500">Confidential Survey</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Mobile Nav Drawer Toggle -->
        <div class="md:hidden absolute top-4 right-4 z-50">
            <button id="mobile-menu-btn" class="bg-white p-2 rounded-md shadow text-slate-600">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <!-- Content Area -->
        <main class="flex-1 flex flex-col relative overflow-hidden bg-slate-50">
            
            <!-- Hero Background for Aesthetics -->
            <div class="absolute inset-0 z-0 opacity-50 pointer-events-none">
                <img src="https://img1.wsimg.com/isteam/ip/0815fdc9-aafc-4fe1-99f8-dedc9ba0e23b/blob-02576cc.png" class="w-full h-full object-cover" alt="Background">
            </div>

            <!-- Progress Bar -->
            <div class="h-1 bg-slate-200 z-20 w-full">
                <div id="progress-bar" class="h-full bg-blue-600 transition-width w-0"></div>
            </div>

            <!-- Scrollable Form Container -->
            <div id="form-container" class="flex-1 overflow-y-auto p-4 md:p-8 z-10 scroll-smooth">
                <div class="max-w-3xl mx-auto space-y-8 pb-20">
                    
                    <form id="discovery-form" onsubmit="return false;">
                        <!-- Sections will be injected here by JS -->
                    </form>

                </div>
            </div>

            <!-- Footer Controls -->
            <div class="bg-white border-t border-slate-200 p-4 z-20 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
                <div class="max-w-3xl mx-auto flex justify-between items-center">
                    <button id="prev-btn" class="px-6 py-2 rounded-lg text-slate-600 font-medium hover:bg-slate-100 transition disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-arrow-left mr-2"></i> Previous
                    </button>
                    
                    <div class="text-sm text-slate-500 font-medium">
                        Step <span id="current-step-display">1</span> of <span id="total-steps-display">10</span>
                    </div>

                    <button id="next-btn" class="px-6 py-2 rounded-lg bg-blue-600 text-white font-medium hover:bg-blue-700 transition shadow-lg shadow-blue-600/20">
                        Next <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>

        </main>
    </div>

    <!-- Submission Modal -->
    <div id="submit-modal" class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-50 hidden flex items-center justify-center opacity-0 transition-opacity duration-300">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 text-center transform scale-95 transition-transform duration-300" id="submit-modal-content">
            <div class="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">
                <i class="fas fa-check"></i>
            </div>
            <h2 class="text-2xl font-bold text-slate-900 mb-2">Analysis Complete</h2>
            <p class="text-slate-600 mb-6">Thank you. Your target market profile qustionnaire has successfully been completed and a report will be generated once we review your responses.</p>
            <button onclick="window.location.reload()" class="w-full py-3 bg-slate-900 text-white rounded-lg font-medium hover:bg-slate-800 transition">
                Start New Questionnaire
            </button>
        </div>
    </div>
    
    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu-overlay" class="fixed inset-0 bg-black/50 z-40 hidden md:hidden backdrop-blur-sm"></div>

    <script>
        // --- DATA STRUCTURE ---
        const sections = [
            {
                id: "s_start",
                title: "Welcome",
                icon: "fa-info-circle",
                content: `
                    <div class="max-w-xl mx-auto text-center space-y-8 pt-10">
                        <div class="w-20 h-20 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto text-3xl">
                            <i class="fas fa-rocket"></i>
                        </div>
                        <div>
                            <h1 class="text-4xl font-bold text-slate-900 mb-4">Target Market Discovery</h1>
                            <p class="text-xl text-slate-600 leading-relaxed">
                                Complete this form and we will email you  written target market profile we can use to guide marketing, pricing, and qualification.
                            </p>
                        </div>
                        
                        <div class="bg-blue-50 border border-blue-100 rounded-xl p-6 text-left">
                            <h3 class="font-semibold text-blue-900 mb-2 flex items-center gap-2">
                                <i class="fas fa-clock"></i> What to expect
                            </h3>
                            <ul class="space-y-2 text-blue-800 text-sm">
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check mt-1 opacity-70"></i>
                                    <span>Takes about 10-15 minutes to complete.</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check mt-1 opacity-70"></i>
                                    <span>We'll cover your ideal industries, client size, geography, and service model.</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check mt-1 opacity-70"></i>
                                    <span>You'll get a generated profile report emailed within 48 business hours.</span>
                                </li>
                            </ul>
                        </div>

                        <button onclick="jumpToStep(1)" class="px-8 py-4 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition shadow-lg shadow-blue-600/30 text-lg w-full md:w-auto">
                            Start Questionnaire <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                `
            },
            {
                id: "s_goals",
                title: "Goals & Capacity",
                icon: "fa-bullseye",
                content: `
                    <div class="space-y-6">
                        <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-slate-900">Firm Goals & Capacity</h2>
                            <p class="text-slate-500 mt-2">Define your growth targets and constraints.</p>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                This helps us align the marketing strategy with your personal objectives. Are we pushing for aggressive scale, optimizing for profit margins, or maintaining a comfortable lifestyle?
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-4">Primary Goal Orientation</label>
                            <div class="space-y-3">
                                <label class="flex items-center gap-3 p-3 border rounded-lg hover:bg-slate-50 cursor-pointer">
                                    <input type="radio" name="s_goals_type" value="Growth" class="w-4 h-4 text-blue-600">
                                    <div>
                                        <div class="font-medium text-slate-900">Growth Focus</div>
                                        <div class="text-xs text-slate-500">Maximize MRR/ARR and market share</div>
                                    </div>
                                </label>
                                <label class="flex items-center gap-3 p-3 border rounded-lg hover:bg-slate-50 cursor-pointer">
                                    <input type="radio" name="s_goals_type" value="Profit" class="w-4 h-4 text-blue-600">
                                    <div>
                                        <div class="font-medium text-slate-900">Profit Focus</div>
                                        <div class="text-xs text-slate-500">Maximize margin per client</div>
                                    </div>
                                </label>
                                <label class="flex items-center gap-3 p-3 border rounded-lg hover:bg-slate-50 cursor-pointer">
                                    <input type="radio" name="s_goals_type" value="Lifestyle" class="w-4 h-4 text-blue-600">
                                    <div>
                                        <div class="font-medium text-slate-900">Lifestyle / Balance</div>
                                        <div class="text-xs text-slate-500">Stable, manageable client base</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                Knowing your capacity constraints ensures we don't overfill your pipeline. We want to generate leads that match your ability to onboard and service them.
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-4">Capacity & Targets</label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-2">New clients in next 6–12 months?</label>
                                    <input type="number" name="s_goals_capacity" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="e.g. 10">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-2">Desired Monthly Retainer</label>
                                    <select name="s_goals_retainer" class="w-full p-3 border border-slate-300 rounded-lg outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="">Select Range...</option>
                                        <option value="Low">&lt; $500</option>
                                        <option value="Medium">$500 – $1,500</option>
                                        <option value="High">$1,500+</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                id: "s1",
                title: "Industry Focus",
                icon: "fa-industry",
                content: `
                    <div class="space-y-6">
                        <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-slate-900">Business Model & Industry</h2>
                            <p class="text-slate-500 mt-2">Identify industries with the greatest bookkeeping need.</p>
                        </div>
                        
                        <!-- Question 1.1 -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                Focusing on specific industries allows for targeted messaging and higher conversion rates. Select the ones where you have the most experience or success.
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-4">
                                1. High Priority Industries <span class="text-red-500" title="Required">*</span>
                            </label>
                            <p class="text-sm text-slate-500 mb-4">
                                Select all broad industries you wish to target.
                                <a href="https://www.census.gov/naics/" target="_blank" class="text-blue-600 hover:underline ml-1">
                                    Industry Lookup by NAICS <i class="fas fa-external-link-alt text-xs"></i>
                                </a>
                            </p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3" id="industry-selection">
                                <!-- Generated via JS -->
                            </div>
                            <div id="other-industry-container" class="mt-3 hidden">
                                <label class="block text-sm font-medium text-slate-700 mb-1">Please specify "Other"</label>
                                <input type="text" name="s1_other_industry" class="w-full p-3 border border-slate-300 rounded-lg outline-none focus:ring-2 focus:ring-blue-500" placeholder="E.g. Biotechnology">
                            </div>
                        </div>

                        <!-- Question 1.2 (Dynamic Matrix) -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative" id="industry-matrix-container" style="display:none;">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                Refining your industry selection helps us prioritize marketing spend. 'Ideal' clients get the most focus, while 'Avoid' industries are filtered out.
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-4">2. Industry Classification</label>
                            <p class="text-sm text-slate-500 mb-4">Classify your selected industries.</p>
                            <div class="space-y-3" id="industry-matrix">
                                <!-- Dynamic Content -->
                            </div>
                        </div>

                        <!-- Question 1.3 -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                Negative targeting is just as important. Specifying industries to avoid prevents wasted ad spend and unqualified leads.
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-2">3. Industries to Avoid</label>
                            <textarea name="s1_avoid" rows="3" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="E.g., Crypto, Cannabis, etc."></textarea>
                        </div>

                         <!-- Question 1.4 -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                This gauges how much educational content or 'thought leadership' we can leverage. Higher expertise allows for more authoritative marketing.
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-2">4. Current Expertise Level (1-5)</label>
                            <p class="text-sm text-slate-500 mb-4">How comfortable is your team with the nuances of these industries?</p>
                            <input type="range" name="s1_expertise" min="1" max="5" value="3" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                            <div class="flex justify-between text-xs text-slate-500 mt-2">
                                <span>Novice</span>
                                <span>Expert</span>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                id: "s2",
                title: "Company Size",
                icon: "fa-chart-pie",
                content: `
                    <div class="space-y-6">
                         <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-slate-900">Revenue & Complexity</h2>
                            <p class="text-slate-500 mt-2">Defining the financial sweet spot.</p>
                        </div>

                        <!-- Revenue Range -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                Revenue size is a proxy for budget and complexity. This ensures we target businesses that can afford your services and have enough transaction volume.
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-4">
                                5. Ideal Annual Revenue Range <span class="text-red-500" title="Required">*</span>
                            </label>
                            <div class="space-y-4" id="revenue-matrix">
                                <!-- JS Generated Matrix -->
                            </div>
                        </div>

                        <!-- Employee Count -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                Employee count helps estimate payroll complexity and HR support needs. It's another indicator of business size and stage.
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-4">8. Ideal Employee Count</label>
                             <div class="space-y-4" id="employee-matrix">
                                <!-- JS Generated Matrix -->
                            </div>
                        </div>
                        
                        <!-- Complexity -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                These specific operational traits (like inventory or multiple locations) indicate higher service needs and stickier client relationships.
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-4">9. Operational "Sweet Spot" Indicators</label>
                            <div class="space-y-2">
                                <label class="flex items-center gap-3 p-3 border border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50">
                                    <input type="checkbox" name="s2_complexity" value="Payroll" class="w-5 h-5 text-blue-600 rounded">
                                    <span>Runs Payroll</span>
                                </label>
                                <label class="flex items-center gap-3 p-3 border border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50">
                                    <input type="checkbox" name="s2_complexity" value="Inventory/Job Costing" class="w-5 h-5 text-blue-600 rounded">
                                    <span>Uses Inventory or Job-Costing</span>
                                </label>
                                <label class="flex items-center gap-3 p-3 border border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50">
                                    <input type="checkbox" name="s2_complexity" value="Multiple Locations" class="w-5 h-5 text-blue-600 rounded">
                                    <span>Multiple Locations / Cost Centers</span>
                                </label>
                                <label class="flex items-center gap-3 p-3 border border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50">
                                    <input type="checkbox" name="s2_complexity" value="High Volume Invoices" class="w-5 h-5 text-blue-600 rounded">
                                    <span>High Volume Invoicing</span>
                                </label>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                id: "s3",
                title: "Age & Stage",
                icon: "fa-hourglass-half",
                content: `
                    <div class="space-y-6">
                        <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-slate-900">Age & Stage</h2>
                            <p class="text-slate-500 mt-2">Maturity of the business lifecycle.</p>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                Startups need setup help, while mature companies need maintenance and advisory. This defines the 'hook' of our marketing message.
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-4">10. Target Business Stages</label>
                            <div class="space-y-4" id="stage-matrix">
                                <!-- JS Generated -->
                            </div>
                        </div>

                         <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                Identifying your superpower allows us to lead with your strongest offering, whether it's rescue work or high-level strategic advice.
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-4">11. Where do you add the most value?</label>
                            <p class="text-sm text-slate-500 mb-4">Choose where your team consistently shines.</p>
                            <div class="grid grid-cols-1 gap-3">
                                <label class="flex items-center gap-3"><input type="checkbox" name="s3_value" value="Setup" class="w-4 h-4 text-blue-600"> Setting up books from scratch</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s3_value" value="Cleanup" class="w-4 h-4 text-blue-600"> Cleaning up messy historical books</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s3_value" value="Maintenance" class="w-4 h-4 text-blue-600"> Ongoing monthly maintenance</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s3_value" value="Advisory" class="w-4 h-4 text-blue-600"> CFO-level Advisory</label>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                id: "s4",
                title: "Structure",
                icon: "fa-sitemap",
                content: `
                    <div class="space-y-6">
                         <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-slate-900">Ownership & Structure</h2>
                            <p class="text-slate-500 mt-2">Defining the organizational complexity.</p>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                Structure impacts tax complexity and reporting needs. We use this to tailor technical content and service packages.
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-4">13. Company Types</label>
                            <div class="space-y-4" id="structure-matrix">
                                <!-- JS Generated -->
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                Knowing who we are selling to (Owner vs. Controller) changes the tone and channel of our outreach.
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-4">14. Decision Maker Preference</label>
                            <div class="space-y-2">
                                <label class="flex items-center gap-3"><input type="radio" name="s4_decision" value="Owner" class="w-4 h-4 text-blue-600"> Owner is decision-maker</label>
                                <label class="flex items-center gap-3"><input type="radio" name="s4_decision" value="FinanceMgr" class="w-4 h-4 text-blue-600"> Report to Finance Manager/Controller</label>
                                <label class="flex items-center gap-3"><input type="radio" name="s4_decision" value="Either" class="w-4 h-4 text-blue-600"> Either is fine</label>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                Psychographics (values, fears, desires) are key to writing copy that resonates. We want to attract clients who value what you offer.
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-4">Ideal Buyer Persona</label>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm text-slate-700 mb-2">Describe your ideal buyer in a sentence or two</label>
                                    <textarea name="s4_persona_desc" rows="2" class="w-full p-3 border border-slate-300 rounded-lg outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g. Detail-oriented owner who values data, not just tax compliance."></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm text-slate-700 mb-2">Key Traits (Select all that apply)</label>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                                        <label class="flex items-center gap-2"><input type="checkbox" name="s4_traits" value="LongTerm" class="w-4 h-4 text-blue-600"> Prioritizes long-term relationships</label>
                                        <label class="flex items-center gap-2"><input type="checkbox" name="s4_traits" value="QualityOverPrice" class="w-4 h-4 text-blue-600"> Willing to pay for quality vs lowest price</label>
                                        <label class="flex items-center gap-2"><input type="checkbox" name="s4_traits" value="DataDriven" class="w-4 h-4 text-blue-600"> Data-driven / wants reporting</label>
                                        <label class="flex items-center gap-2"><input type="checkbox" name="s4_traits" value="HandsOff" class="w-4 h-4 text-blue-600"> Hands-off / wants 'done for you'</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                id: "s5",
                title: "Geography",
                icon: "fa-map-marked-alt",
                content: `
                    <div class="space-y-6">
                        <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-slate-900">Geography</h2>
                            <p class="text-slate-500 mt-2">Where do your ideal clients operate?</p>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                Local SEO strategies differ from national ones. This determines if we focus on 'near me' searches or broader content marketing.
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-4">
                                16. Service Range <span class="text-red-500" title="Required">*</span>
                            </label>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <label class="cursor-pointer">
                                    <input type="radio" name="s5_geo" value="Local" class="peer sr-only custom-radio">
                                    <div class="p-4 border rounded-lg hover:bg-slate-50 peer-checked:border-blue-500 peer-checked:bg-blue-50 transition text-center">
                                        <div class="font-semibold">Local Only</div>
                                        <div class="text-xs text-slate-500">Hampton Roads</div>
                                    </div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="s5_geo" value="Regional" class="peer sr-only custom-radio">
                                    <div class="p-4 border rounded-lg hover:bg-slate-50 peer-checked:border-blue-500 peer-checked:bg-blue-50 transition text-center">
                                        <div class="font-semibold">Regional</div>
                                        <div class="text-xs text-slate-500">VA & Neighbors</div>
                                    </div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="s5_geo" value="National" class="peer sr-only custom-radio">
                                    <div class="p-4 border rounded-lg hover:bg-slate-50 peer-checked:border-blue-500 peer-checked:bg-blue-50 transition text-center">
                                        <div class="font-semibold">National</div>
                                        <div class="text-xs text-slate-500">Anywhere US</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                If you have a local focus, targeting specific cities or regions can yield high ROI through localized campaigns.
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-2">17. Specific Priority Areas</label>
                            <input type="text" name="s5_priority" class="w-full p-3 border border-slate-300 rounded-lg outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g. Richmond, VA; Norfolk; I-64 corridor">
                        </div>
                    </div>
                `
            },
            {
                id: "s6",
                title: "Facilities",
                icon: "fa-building",
                content: `
                    <div class="space-y-6">
                        <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-slate-900">Facilities & Assets</h2>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                Physical presence (like retail vs. office) implies different accounting needs (rent, property tax, assets). It helps narrow down industry targeting.
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-4">20. Facility Types</label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <label class="flex items-center gap-3 p-2 border rounded hover:bg-slate-50"><input type="checkbox" name="s6_facility" value="Office" class="w-4 h-4 text-blue-600"> Professional Offices</label>
                                <label class="flex items-center gap-3 p-2 border rounded hover:bg-slate-50"><input type="checkbox" name="s6_facility" value="Retail" class="w-4 h-4 text-blue-600"> Retail Storefronts</label>
                                <label class="flex items-center gap-3 p-2 border rounded hover:bg-slate-50"><input type="checkbox" name="s6_facility" value="Restaurant" class="w-4 h-4 text-blue-600"> Restaurants/Food</label>
                                <label class="flex items-center gap-3 p-2 border rounded hover:bg-slate-50"><input type="checkbox" name="s6_facility" value="Warehouse" class="w-4 h-4 text-blue-600"> Warehouse/Distribution</label>
                                <label class="flex items-center gap-3 p-2 border rounded hover:bg-slate-50"><input type="checkbox" name="s6_facility" value="Manufacturing" class="w-4 h-4 text-blue-600"> Manufacturing Plants</label>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                id: "s7",
                title: "Risk & Profile",
                icon: "fa-shield-alt",
                content: `
                    <div class="space-y-6">
                        <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-slate-900">Risk & Profile</h2>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                This informs our qualification process. If you only want stable clients, we'll look for established businesses with credit history.
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-4">22. Importance of Financial Stability</label>
                            <select name="s7_stability" class="w-full p-3 border border-slate-300 rounded-lg outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="Critical">Critical - Only stable clients</option>
                                <option value="Flexible">Important but flexible</option>
                                <option value="NotFactor">Not a major factor (willing to cleanup)</option>
                            </select>
                        </div>

                         <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                Aligning with minority or veteran-owned businesses can be a powerful niche and differentiator in the market.
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-4">24. Mission Fit / Priorities</label>
                            <div class="space-y-2">
                                <label class="flex items-center gap-3"><input type="checkbox" name="s7_mission" value="MinorityOwned" class="w-4 h-4 text-blue-600"> Minority-owned businesses</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s7_mission" value="WomenOwned" class="w-4 h-4 text-blue-600"> Women-owned businesses</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s7_mission" value="VeteranOwned" class="w-4 h-4 text-blue-600"> Veteran-owned businesses</label>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                We use these to build 'anti-personas'—qualifying questions that weed out bad fit clients early in the sales process.
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-4">Client Red Flags (Deal Killers)</label>
                            <p class="text-sm text-slate-500 mb-4">Select signals that would disqualify a prospect.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4">
                                <label class="flex items-center gap-2"><input type="checkbox" name="s7_redflags" value="LatePayers" class="w-4 h-4 text-red-600"> Chronic late payers</label>
                                <label class="flex items-center gap-2"><input type="checkbox" name="s7_redflags" value="NonCompliant" class="w-4 h-4 text-red-600"> Non-compliant / multiple years unfiled</label>
                                <label class="flex items-center gap-2"><input type="checkbox" name="s7_redflags" value="Unresponsive" class="w-4 h-4 text-red-600"> Unresponsive / slow to provide docs</label>
                                <label class="flex items-center gap-2"><input type="checkbox" name="s7_redflags" value="NoSeparation" class="w-4 h-4 text-red-600"> Commingled personal/business funds</label>
                                <label class="flex items-center gap-2"><input type="checkbox" name="s7_redflags" value="Ethics" class="w-4 h-4 text-red-600"> Questionable ethics / aggressive tax schemes</label>
                            </div>
                            <input type="text" name="s7_redflags_other" class="w-full p-3 border border-slate-300 rounded-lg outline-none focus:ring-2 focus:ring-blue-500" placeholder="Any other deal breakers?">
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                This tells us how big the gap is. A large gap means a more aggressive pivot in marketing strategy is needed.
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-4">Current vs Ideal Fit</label>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-2">Roughly what % of your current clients match this ideal profile today?</label>
                                    <div class="flex gap-4">
                                        <label class="flex items-center gap-2"><input type="radio" name="s7_match_pct" value="0-25" class="w-4 h-4 text-blue-600"> 0–25%</label>
                                        <label class="flex items-center gap-2"><input type="radio" name="s7_match_pct" value="26-50" class="w-4 h-4 text-blue-600"> 26–50%</label>
                                        <label class="flex items-center gap-2"><input type="radio" name="s7_match_pct" value="51-75" class="w-4 h-4 text-blue-600"> 51–75%</label>
                                        <label class="flex items-center gap-2"><input type="radio" name="s7_match_pct" value="76-100" class="w-4 h-4 text-blue-600"> 76–100%</label>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-2">Who do you currently attract that you would like less of?</label>
                                    <textarea name="s7_less_of" rows="2" class="w-full p-3 border border-slate-300 rounded-lg outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g. Price shoppers, messy cleanups..."></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                id: "s8",
                title: "Digital & Compliance",
                icon: "fa-laptop-code",
                content: `
                    <div class="space-y-6">
                        <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-slate-900">Digital Presence & Compliance</h2>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                Clients already using cloud tools are easier to onboard. This targets 'tech-forward' businesses vs. those needing a full digital transformation.
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-4">27. Existing Tech Stack Preference</label>
                            <div class="space-y-2">
                                <label class="flex items-center gap-3"><input type="checkbox" name="s8_tech" value="AccountingSoftware" class="w-4 h-4 text-blue-600"> Already use Accounting Software (QBO/Xero)</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s8_tech" value="POS" class="w-4 h-4 text-blue-600"> Use POS/Inventory Systems</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s8_tech" value="OnlinePay" class="w-4 h-4 text-blue-600"> Online Invoicing/Payments</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s8_tech" value="Payroll Reporting" class="w-4 h-4 text-blue-600"> Payroll Reporting</label>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                Specialized compliance needs (like audits or government contracts) allow for premium pricing and specialized positioning.
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-4">28. Compliance Complexity</label>
                            <p class="text-sm text-slate-500 mb-4">Select types you are comfortable supporting:</p>
                            <div class="space-y-2">
                                <label class="flex items-center gap-3"><input type="checkbox" name="s8_comp" value="Audited" class="w-4 h-4 text-blue-600"> Regularly Audited</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s8_comp" value="ImportExport" class="w-4 h-4 text-blue-600"> Import/Export Activities</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s8_comp" value="GovContractor" class="w-4 h-4 text-blue-600"> Government Contractors / Grants</label>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                id: "s9",
                title: "Service Needs",
                icon: "fa-hands-helping",
                content: `
                    <div class="space-y-6">
                         <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-slate-900">Service Engagement</h2>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                We will build your core offer around these services. This ensures every lead we generate is interested in what you *must* sell.
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-4">
                                30. Non-Negotiable Services <span class="text-red-500" title="Required">*</span>
                            </label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <label class="flex items-center gap-3"><input type="checkbox" name="s9_service" value="Bookkeeping" checked class="w-4 h-4 text-blue-600"> Monthly Bookkeeping</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s9_service" value="Payroll" class="w-4 h-4 text-blue-600"> Payroll</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s9_service" value="AR" class="w-4 h-4 text-blue-600"> A/R (Invoicing)</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s9_service" value="AP" class="w-4 h-4 text-blue-600"> A/P (Bill Pay)</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s9_service" value="Cleanup" class="w-4 h-4 text-blue-600"> Cleanup/Catch-up</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s9_service" value="Advisory" class="w-4 h-4 text-blue-600"> CFO/Advisory</label>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                High volume requires automated marketing funnels, while complex retainers require high-touch, account-based marketing.
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-4">32. Volume Strategy</label>
                            <div class="space-y-3">
                                <label class="flex items-center gap-3 p-3 border rounded-lg hover:bg-slate-50 cursor-pointer">
                                    <input type="radio" name="s9_volume" value="Volume" class="w-4 h-4 text-blue-600">
                                    <span>High volume of small/medium retainers</span>
                                </label>
                                <label class="flex items-center gap-3 p-3 border rounded-lg hover:bg-slate-50 cursor-pointer">
                                    <input type="radio" name="s9_volume" value="Complex" class="w-4 h-4 text-blue-600">
                                    <span>Fewer larger, complex retainers</span>
                                </label>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                            <button type="button" class="absolute top-4 right-4 text-slate-400 hover:text-blue-600 transition-colors" onclick="toggleHelp(this)">
                                <i class="fas fa-question-circle text-lg"></i>
                            </button>
                            <div class="help-popup hidden absolute top-10 right-4 w-64 p-4 bg-slate-800 text-white text-xs rounded-lg shadow-xl z-20 text-left">
                                Your pricing model filters out price shoppers. We position your value to match your fee structure (e.g., value-based vs. hourly).
                                <div class="absolute -top-1 right-2 w-2 h-2 bg-slate-800 transform rotate-45"></div>
                            </div>
                            <label class="block text-lg font-semibold text-slate-900 mb-4">Pricing & Model</label>
                            <div class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-3">Preferred Engagement Model</label>
                                    <div class="flex flex-col sm:flex-row gap-3">
                                        <label class="flex items-center gap-2"><input type="radio" name="s9_model" value="Fixed" class="w-4 h-4 text-blue-600"> Fixed-fee Monthly</label>
                                        <label class="flex items-center gap-2"><input type="radio" name="s9_model" value="Hourly" class="w-4 h-4 text-blue-600"> Hourly / Project</label>
                                        <label class="flex items-center gap-2"><input type="radio" name="s9_model" value="Hybrid" class="w-4 h-4 text-blue-600"> Hybrid</label>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-3">Price Sensitivity of Ideal Client</label>
                                    <div class="space-y-2">
                                        <label class="flex items-center gap-2"><input type="radio" name="s9_sensitivity" value="High" class="w-4 h-4 text-blue-600"> Very price-sensitive (Shopping for lowest cost)</label>
                                        <label class="flex items-center gap-2"><input type="radio" name="s9_sensitivity" value="Medium" class="w-4 h-4 text-blue-600"> Moderately value-driven</label>
                                        <label class="flex items-center gap-2"><input type="radio" name="s9_sensitivity" value="Low" class="w-4 h-4 text-blue-600"> Premium (Willing to pay for high touch)</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                id: "s_review",
                title: "Review",
                icon: "fa-clipboard-check",
                content: `
                    <div class="space-y-6">
                        <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-slate-900">Review & Confirm</h2>
                            <p class="text-slate-500 mt-2">Double check your target market profile before generating the report.</p>
                        </div>
                        
                        <div id="review-summary-container" class="space-y-4">
                            <!-- Dynamic Content -->
                        </div>
                        
                        <button onclick="jumpToStep(sections.length - 1)" class="w-full py-4 bg-slate-900 text-white font-bold rounded-lg hover:bg-slate-800 transition">
                            Looks Good, Finalize <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                `
            },
            {
                id: "s10",
                title: "Contact Info",
                icon: "fa-address-card",
                content: `
                    <div class="space-y-6">
                        <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-slate-900">Finalize Profile</h2>
                            <p class="text-slate-500 mt-2">Enter your contact details to generate the target market report.</p>
                        </div>
                        
                        <div class="bg-white p-8 rounded-xl shadow-lg border border-slate-200 max-w-xl mx-auto">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1">First Name</label>
                                    <input type="text" name="firstName" required class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1">Last Name</label>
                                    <input type="text" name="lastName" required class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-slate-700 mb-1">Email Address</label>
                                <input type="email" name="email" required class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                            </div>

                            <div class="mb-6">
                                <label class="block text-sm font-medium text-slate-700 mb-1">Phone Number</label>
                                <input type="tel" name="phone" required class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                            </div>

                            <div class="mb-6">
                                <label class="flex items-start gap-3 cursor-pointer">
                                    <input type="checkbox" name="contactConsent" required class="w-5 h-5 text-blue-600 rounded mt-0.5">
                                    <span class="text-sm text-slate-600">I consent to being contacted regarding my target market analysis results.</span>
                                </label>
                            </div>
                            
                            <!-- Error Container -->
                            <div id="form-errors" class="hidden mb-6 p-4 bg-red-50 text-red-700 text-sm rounded-lg border border-red-200"></div>

                            <!-- Privacy Note -->
                            <div class="mb-6 text-xs text-slate-500 text-center">
                                <i class="fas fa-lock mr-1"></i> Your data is secure. We use this info solely for your analysis and will never sell or share your details.
                            </div>

                            <button type="button" onclick="submitForm()" class="w-full py-4 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition shadow-lg shadow-blue-600/30">
                                Complete & Generate Report
                            </button>
                        </div>
                    </div>
                `
            }
        ];

        // --- CONSTANTS ---
        const industries = [
            "Construction & Trades", "Manufacturing", "Transportation / Logistics",
            "Professional Services", "Medical / Healthcare", "Restaurants & Food",
            "Retail (Brick-and-Mortar)", "E-commerce", "Real Estate / Property Mgmt", "Nonprofits",
            "Other"
        ];

        const revenues = [
            "Under $250k", "$250k–$499k", "$500k–$999k", "$1M–$4.9M", "$5M–$9.9M", "$10M+"
        ];

        const employees = [
            "0–2 (Micro)", "3–9 (Small Team)", "10–24 (Growing)", "25–49", "50+"
        ];

        const stages = [
            "Startups (0-2 yrs)", "Early Growth (3-5 yrs)", "Established (6-10 yrs)", "Mature (10+ yrs)"
        ];

        const structures = [
            "Independent Local", "Franchises", "Subsidiaries", "Multi-Entity Groups"
        ];

        // --- APP STATE ---
        let currentStep = 0;
        let formData = {};

        // --- INITIALIZATION ---
        // (Cleaned up: Removed duplicate conflicting initialization)


        // --- RENDERING LOGIC ---

        function renderNav() {
            const nav = document.getElementById('desktop-nav');
            nav.innerHTML = sections.map((sec, idx) => `
                <button onclick="jumpToStep(${idx})" 
                    class="w-full flex items-center gap-3 px-3 py-2 rounded-md transition-colors text-sm mb-1 text-left ${idx === 0 ? 'bg-slate-800 text-white' : 'text-slate-400 hover:text-white hover:bg-slate-800'}" 
                    id="nav-btn-${idx}">
                    <i class="fas ${sec.icon} w-5 text-center"></i>
                    ${sec.title}
                </button>
            `).join('');
        }

        function renderDynamicContent() {
            // Render Industry Checkboxes
            const indContainer = document.getElementById('industry-selection');
            if (indContainer) {
                indContainer.innerHTML = industries.map(ind => `
                    <label class="flex items-center p-3 border rounded-lg hover:bg-slate-50 cursor-pointer transition">
                        <input type="checkbox" name="industry-checkbox" value="${ind}" class="w-5 h-5 text-blue-600 rounded mr-3 industry-checkbox">
                        <span class="text-sm font-medium">${ind}</span>
                    </label>
                `).join('');
            }

            // Render Matrix Builders
            renderMatrix('revenue-matrix', revenues, 's2_rev');
            renderMatrix('employee-matrix', employees, 's2_emp');
            renderMatrix('stage-matrix', stages, 's3_stage');
            renderMatrix('structure-matrix', structures, 's4_struct');
        }

        function renderMatrix(containerId, items, namePrefix) {
            const container = document.getElementById(containerId);
            if (!container) return;
            container.innerHTML = items.map(item => `
                <div class="flex flex-col md:flex-row md:items-center justify-between p-4 bg-slate-50 rounded-lg border border-slate-100">
                    <span class="font-medium text-slate-700 mb-2 md:mb-0">${item}</span>
                    <div class="flex gap-2">
                        ${generateRadioGroup(namePrefix, item)}
                    </div>
                </div>
            `).join('');
        }

        function generateRadioGroup(prefix, itemKey) {
            // sanitize key for ID
            const safeKey = itemKey.replace(/[^a-zA-Z0-9]/g, '');
            return `
                <label class="cursor-pointer">
                    <input type="radio" name="${prefix}_${safeKey}" value="Ideal" class="peer sr-only custom-radio">
                    <div class="px-3 py-1 rounded border border-slate-200 text-xs font-medium text-slate-500 hover:bg-white transition peer-checked:border-green-500 peer-checked:bg-green-50 peer-checked:text-green-700">Ideal</div>
                </label>
                <label class="cursor-pointer">
                    <input type="radio" name="${prefix}_${safeKey}" value="Acceptable" class="peer sr-only custom-radio">
                    <div class="px-3 py-1 rounded border border-slate-200 text-xs font-medium text-slate-500 hover:bg-white transition peer-checked:border-yellow-500 peer-checked:bg-yellow-50 peer-checked:text-yellow-700">OK</div>
                </label>
                <label class="cursor-pointer">
                    <input type="radio" name="${prefix}_${safeKey}" value="Avoid" class="peer sr-only custom-radio">
                    <div class="px-3 py-1 rounded border border-slate-200 text-xs font-medium text-slate-500 hover:bg-white transition peer-checked:border-red-500 peer-checked:bg-red-50 peer-checked:text-red-700">Avoid</div>
                </label>
            `;
        }

        function updateIndustryMatrix() {
            const selected = Array.from(document.querySelectorAll('.industry-checkbox:checked')).map(cb => cb.value);
            const container = document.getElementById('industry-matrix-container');
            const list = document.getElementById('industry-matrix');
            
            // Toggle Other Input
            const otherInput = document.getElementById('other-industry-container');
            if (otherInput) {
                if (selected.includes('Other')) {
                    otherInput.classList.remove('hidden');
                } else {
                    otherInput.classList.add('hidden');
                }
            }

            if (selected.length === 0) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'block';
            // Only re-render if count changes to avoid clearing choices (simplification for this demo)
            list.innerHTML = selected.map(ind => `
                <div class="flex items-center justify-between p-3 bg-slate-50 rounded border border-slate-100">
                    <span class="text-sm font-semibold">${ind}</span>
                    <div class="flex gap-2">
                        ${generateRadioGroup('s1_ind_class', ind)}
                    </div>
                </div>
            `).join('');
        }

        // --- NAVIGATION LOGIC ---

        // (Cleaned up: Removed obsolete jumpToStep and showStep functions that caused conflicts)


        // *Overwriting showStep for data persistence*
        // First, let's inject ALL sections into the DOM hidden, then toggle.
        const originalInit = document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('discovery-form');
            form.innerHTML = sections.map((sec, i) => `
                <div id="section-wrapper-${i}" class="${i === 0 ? 'block' : 'hidden'} animate-fade-in">
                    ${sec.content}
                </div>
            `).join('');
            
            renderNav();
            renderDynamicContent();
            
            // Re-attach specific listener for step 1
            const indContainer = document.getElementById('industry-selection');
            if(indContainer) indContainer.addEventListener('change', updateIndustryMatrix);
            
            // Attach Nav Listeners
            document.getElementById('prev-btn').addEventListener('click', () => jumpToStep(currentStep - 1));
            document.getElementById('next-btn').addEventListener('click', () => jumpToStep(currentStep + 1));

            // Mobile menu
            document.getElementById('mobile-menu-btn').addEventListener('click', toggleMobileMenu);
            // Overlay click
            document.getElementById('mobile-menu-overlay').addEventListener('click', toggleMobileMenu);

            // Initialize UI state
            if (!restoreState()) {
                updateUI(currentStep);
            }
            document.getElementById('total-steps-display').innerText = sections.length;
            
            // Auto-save
            form.addEventListener('change', () => {
                const data = new FormData(form);
                const obj = {};
                data.forEach((value, key) => {
                    if(!obj[key]) obj[key] = value;
                    else {
                        if(!Array.isArray(obj[key])) obj[key] = [obj[key]];
                        obj[key].push(value);
                    }
                });
                localStorage.setItem('tmq_form_data', JSON.stringify(obj));
            });
        });

        // State Restoration
        function restoreState() {
            const savedStep = localStorage.getItem('tmq_current_step');
            const savedData = localStorage.getItem('tmq_form_data');
            
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    // Naive restoration for inputs
                    Object.keys(data).forEach(key => {
                        const val = data[key];
                        const inputs = document.querySelectorAll(`[name="${key}"]`);
                        if (inputs.length) {
                            if (inputs[0].type === 'radio') {
                                const radio = document.querySelector(`input[name="${key}"][value="${val}"]`);
                                if(radio) radio.checked = true;
                            } else if (inputs[0].type === 'checkbox') {
                                const vals = Array.isArray(val) ? val : [val];
                                vals.forEach(v => {
                                    const cb = document.querySelector(`input[name="${key}"][value="${v}"]`);
                                    if(cb) cb.checked = true;
                                });
                            } else {
                                inputs[0].value = val;
                            }
                        }
                    });
                    
                    // Trigger dynamic updates
                    updateIndustryMatrix();
                } catch(e) { console.error('Restore failed', e); }
            }

            if (savedStep && parseInt(savedStep) > 0) {
                // Optional: ask user? For now, let's just restore if > 0
                // Or maybe simple toast? Let's just restore silently for smooth UX.
                jumpToStep(parseInt(savedStep));
                return true;
            }
            return false;
        }

        // Redefine jumpToStep for the show/hide approach
        function jumpToStep(idx) {
             if (idx < 0 || idx >= sections.length) return;
             
             // Save step
             localStorage.setItem('tmq_current_step', idx);

             // Hide current
             document.getElementById(`section-wrapper-${currentStep}`).classList.add('hidden');
             document.getElementById(`section-wrapper-${currentStep}`).classList.remove('block');
             
             currentStep = idx;

             // Show new
             const newSec = document.getElementById(`section-wrapper-${currentStep}`);
             newSec.classList.remove('hidden');
             newSec.classList.add('block');

             // Render Review if needed
             if (sections[idx].id === 's_review') {
                 renderReviewSummary();
             }

             // Update UI
             updateUI(idx);
        }

        function updateUI(idx) {
            // Update Step Display with Title
            document.getElementById('current-step-display').innerText = idx + 1;
            const stepLabel = document.createElement('span');
            stepLabel.className = "ml-2 text-xs font-normal text-slate-400 hidden sm:inline-block";
            stepLabel.innerText = `Now: ${sections[idx].title}`;
            
            const countContainer = document.getElementById('current-step-display').parentElement;
            // Clear previous label if any (hacky but simple)
            const oldLabel = countContainer.querySelector('span.text-slate-400');
            if(oldLabel) oldLabel.remove();
            countContainer.appendChild(stepLabel);

             // Progress Bar
            const pct = ((idx + 1) / sections.length) * 100;
            document.getElementById('progress-bar').style.width = `${pct}%`;

            // Sidebar Active State
            document.querySelectorAll('[id^="nav-btn-"]').forEach((btn, i) => {
                if (i === idx) {
                    btn.className = "w-full flex items-center gap-3 px-3 py-2 rounded-md transition-colors text-sm mb-1 text-left bg-slate-800 text-white shadow-lg shadow-black/20 font-medium border-l-4 border-blue-500";
                } else {
                    btn.className = "w-full flex items-center gap-3 px-3 py-2 rounded-md transition-colors text-sm mb-1 text-left text-slate-400 hover:text-white hover:bg-slate-800";
                }
            });

             // Button States
            document.getElementById('prev-btn').disabled = (idx === 0);
            
            // Adjust buttons for mobile (full width)
            document.getElementById('prev-btn').className = "px-6 py-2 rounded-lg text-slate-600 font-medium hover:bg-slate-100 transition disabled:opacity-50 disabled:cursor-not-allowed w-full md:w-auto mb-2 md:mb-0";
            document.getElementById('next-btn').className = "px-6 py-2 rounded-lg bg-blue-600 text-white font-medium hover:bg-blue-700 transition shadow-lg shadow-blue-600/20 w-full md:w-auto";

            // Hide Next button on final step or start step if desired
            // (Keeping Next button on Start step is redundant if we have the big CTA, but let's leave it for consistency or hide it)
            if (idx === 0) {
                 // Start screen has its own button, maybe hide footer next?
                 // Let's keep it for consistency but maybe change text?
                 // Actually, standard behavior is fine.
            }

            if (idx === sections.length - 1) {
                document.getElementById('next-btn').style.display = 'none';
            } else {
                document.getElementById('next-btn').style.display = 'flex';
                // Remove onclick here as it's added in init
            }
            
             // Scroll top
            document.getElementById('form-container').scrollTo(0,0);
        }

        function renderReviewSummary() {
            const container = document.getElementById('review-summary-container');
            if (!container) return;

            // Collect data
            const form = document.getElementById('discovery-form');
            const data = new FormData(form);
            const summary = [];

            // Helper to get checked inputs
            const getChecked = (name) => {
                const els = document.querySelectorAll(`input[name="${name}"]:checked`);
                return Array.from(els).map(e => e.parentElement.textContent.trim());
            };
            
            // Industries
            const inds = getChecked('industry-selection'); // The JS generation doesn't use name attribute correctly for main checkboxes?
            // Wait, in renderDynamicContent: <input type="checkbox" value="${ind}" class="... industry-checkbox">
            // It lacks a 'name' attribute! Let's fix that in this function or use the class.
            const indEls = document.querySelectorAll('.industry-checkbox:checked');
            const selectedInds = Array.from(indEls).map(e => e.value);

            if (selectedInds.length > 0) {
                summary.push(createSummaryCard('Target Industries', selectedInds.join(', ')));
            } else {
                 summary.push(createSummaryCard('Target Industries', 'None selected', true));
            }

            // Rev Range
            // The matrix uses radio buttons with names like s2_rev_Under250k
            // This is hard to summarize automatically without specific mapping.
            // Let's just summary key fields for now.
            
            const services = getChecked('s9_service');
            summary.push(createSummaryCard('Core Services', services.length ? services.join(', ') : 'None selected'));

            const geo = data.get('s5_geo');
            summary.push(createSummaryCard('Geography', geo || 'Not specified'));
            
            const goals = data.get('s_goals_type');
            if(goals) summary.push(createSummaryCard('Primary Goal', goals));

            container.innerHTML = summary.join('');
        }

        function createSummaryCard(title, value, isWarning = false) {
            return `
                <div class="bg-white p-4 rounded-lg border ${isWarning ? 'border-red-200 bg-red-50' : 'border-slate-200'}">
                    <h4 class="text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">${title}</h4>
                    <p class="${isWarning ? 'text-red-700' : 'text-slate-800'} font-medium">${value}</p>
                </div>
            `;
        }

        function toggleMobileMenu() {
            const nav = document.getElementById('desktop-nav').parentElement.parentElement;
            const overlay = document.getElementById('mobile-menu-overlay');
            const isOpen = !nav.classList.contains('hidden');
            
            if (isOpen) {
                // Close
                nav.classList.add('hidden');
                nav.classList.remove('fixed', 'inset-y-0', 'left-0', 'bg-slate-900', 'z-50', 'w-64');
                overlay.classList.add('hidden');
            } else {
                // Open
                nav.classList.remove('hidden');
                nav.classList.add('fixed', 'inset-y-0', 'left-0', 'bg-slate-900', 'z-50', 'w-64');
                overlay.classList.remove('hidden');
                
                // Add close button if not exists
                if (!nav.querySelector('.mobile-close')) {
                    const closeBtn = document.createElement('button');
                    closeBtn.className = "mobile-close absolute top-4 right-4 text-slate-400 hover:text-white";
                    closeBtn.innerHTML = '<i class="fas fa-times text-xl"></i>';
                    closeBtn.onclick = toggleMobileMenu;
                    nav.appendChild(closeBtn);
                }
            }
        }


        function toggleHelp(btn) {
            const popup = btn.nextElementSibling;
            const isHidden = popup.classList.contains('hidden');
            
            // Close all others
            document.querySelectorAll('.help-popup').forEach(el => el.classList.add('hidden'));
            
            if (isHidden) {
                popup.classList.remove('hidden');
            }
        }

        // Close popups when clicking outside
        document.addEventListener('click', (e) => {
            const isButton = e.target.closest('button[onclick^="toggleHelp"]');
            const isPopup = e.target.closest('.help-popup');
            
            if (!isButton && !isPopup) {
                document.querySelectorAll('.help-popup').forEach(el => el.classList.add('hidden'));
            }
        });

        function submitForm() {
            const form = document.getElementById('discovery-form');
            const errorDiv = document.getElementById('form-errors');
            const btn = document.querySelector('button[onclick="submitForm()"]');
            
            // Clear errors
            errorDiv.classList.add('hidden');
            errorDiv.innerHTML = '';

            const data = new FormData(form);
            const obj = {};
            
            // 1. Convert & Normalize Data
            for (let [key, value] of data.entries()) {
                if (obj[key]) {
                    if (!Array.isArray(obj[key])) {
                        obj[key] = [obj[key]];
                    }
                    obj[key].push(value);
                } else {
                    obj[key] = value;
                }
            }
            
            // Flatten Arrays to Strings for Sheets
            Object.keys(obj).forEach(key => {
                if (Array.isArray(obj[key])) {
                    obj[key] = obj[key].join(', ');
                }
            });

            // 2. Validation
            const requiredFields = [
                { key: 'firstName', label: 'First Name' },
                { key: 'lastName', label: 'Last Name' },
                { key: 'email', label: 'Email' },
                { key: 'contactConsent', label: 'Consent Checkbox' }
            ];
            
            // Strategic Requireds (checking if keys exist in obj)
            // Note: checkboxes won't appear in FormData if unchecked, so we check existence
            // Industry
            const hasIndustry = document.querySelectorAll('.industry-checkbox:checked').length > 0;
            if (!hasIndustry) requiredFields.push({ label: 'At least one Industry (Step 2)', missing: true });
            
            // Service Range
            if (!obj['s5_geo']) requiredFields.push({ label: 'Service Range (Step 6)', missing: true });
            
            // Non-Negotiables (s9_service)
            if (!obj['s9_service']) requiredFields.push({ label: 'Core Services (Step 10)', missing: true });

            const missing = requiredFields.filter(f => f.missing || !obj[f.key]);
            
            if (missing.length > 0) {
                errorDiv.innerHTML = `<strong>Please fill in the following required fields:</strong><br>${missing.map(m => m.label).join(', ')}`;
                errorDiv.classList.remove('hidden');
                return;
            }

            // 3. Metadata
            obj.timestamp = new Date().toISOString();
            obj.sessionId = localStorage.getItem('tmq_session_id') || crypto.randomUUID();
            localStorage.setItem('tmq_session_id', obj.sessionId); // persist session
            obj.userAgent = navigator.userAgent;
            obj.viewport = `${window.innerWidth}x${window.innerHeight}`;
            obj.version = "1.0.0";

            // 4. Send to GAS
            const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxKoc309Yg1uiLbK6EqMSp2aJftCZVtFXN-NUSrncPvc7TW03sGBDL1G5U9MuSOH4Ad/exec';

            const originalBtnText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            btn.disabled = true;

            fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors', // standard for GAS
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(obj)
            }).then(() => {
                // Clear storage on success
                localStorage.removeItem('tmq_current_step');
                localStorage.removeItem('tmq_form_data');
                showSuccess();
            }).catch(e => {
                console.error(e);
                errorDiv.innerText = 'Network error. Please try again.';
                errorDiv.classList.remove('hidden');
                btn.innerHTML = originalBtnText;
                btn.disabled = false;
            });
        }

        function showSuccess() {
            const modal = document.getElementById('submit-modal');
            const content = document.getElementById('submit-modal-content');
            modal.classList.remove('hidden');
            // small delay to allow display:block to apply before opacity transition
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                content.classList.remove('scale-95');
                content.classList.add('scale-100');
            }, 10);
        }

    </script>
</body>
</html>
